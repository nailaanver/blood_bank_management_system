{% extends 'master.html' %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
{% if messages %}
  {% for message in messages %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  {% endfor %}
{% endif %}
<header class="header">
    <div class="logosec">
        <div class="logo">Donor Dashboard</div>
    </div>

    <div class="welcome-admin">
        <span>Welcome, {{ user.username }}</span>
        <img src="{{ user.donordetail.profile_photo.url }}" alt="Profile Photo">
    </div>
</header>


<div class="main-container">
    <div class="navcontainer">
        <nav class="nav">
            <div class="nav-upper-options">

                <div class="nav-option option1 " data-page="{% url 'admin_dashboard_content' %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Dashboard</h3>
                </div>

                <div class="nav-option option2" data-page="{% url 'update_donor_detail' %}">
                    <i class="fas fa-user-cog"></i>
                    <h3>Update Details</h3>
                </div>

                <div class="nav-option option3" data-page="{% url 'view_donation_history' %}">
                    <i class="fa fa-users"></i>
                    <h3>View Donation History</h3>
                </div>
                <div class="nav-option option4" data-page="{% url 'check_eligibility' %}">
                    <i class="fa fa-heartbeat"></i>
                    <h3>Check Eligibility</h3>
                </div>
                <div class="nav-option option5" data-page="{% url 'request_appoiments' %}">
                    <i class="fa fa-users"></i>
                    <h3>Request Appoiments</h3>
                </div>
                <div>

                <a href="{% url 'logout' %}" class="nav-option option6">
                    <i class="fa fa-sign-out-alt"></i>
                    <h3 class="logout-line">Logout</h3>
                </a>
                </div>
            </div>
        </nav>
    </div>
    

    <div class="main" id="main-content">
        <!-- Dynamic content loads here -->
    </div>
</div>

 <!-- ================== JS Script ==================  -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainContent = document.getElementById('main-content');
    const params = new URLSearchParams(window.location.search);
    const section = params.get('section');
    const message = params.get('msg');

    // ✅ Show success message if exists
    if (message) {
        const alertBox = document.createElement('div');
        alertBox.classList.add('alert-success');
        alertBox.textContent = decodeURIComponent(message);
        document.body.prepend(alertBox);
        setTimeout(() => alertBox.remove(), 4000);
    }

    // Determine default section page
    let defaultPageUrl = "{% url 'admin_dashboard_content' %}";  // fallback
    let activeOptionClass = 'option1';  // default

    if (section === 'update_details') {
        defaultPageUrl = "{% url 'update_donor_detail' %}";
        activeOptionClass = 'option2';
    } else if (section === 'view_donation_history') {
        defaultPageUrl = "{% url 'view_donation_history' %}";
        activeOptionClass = 'option3';
    } else if (section === 'check_eligibility') {
        defaultPageUrl = "{% url 'check_eligibility' %}";
        activeOptionClass = 'option4';
    } else if (section === 'request_appoiments') {
        defaultPageUrl = "{% url 'request_appoiments' %}";
        activeOptionClass = 'option5';
    }

    // ✅ Load the correct page in main-content
    loadPage(defaultPageUrl);
    setActiveOption(activeOptionClass);

    // Sidebar click handling
    document.querySelector('.navcontainer').addEventListener('click', function(e) {
        const target = e.target.closest('.nav-option');
        if (!target) return;
        e.preventDefault();

        const pageUrl = target.getAttribute('data-page');
        if (!pageUrl) return;

        setActiveOption(target.classList[1]);
        loadPage(pageUrl);
    });

    // Load a page into main-content
    function loadPage(url) {
        fetch(url, { headers: { 'X-Requested-With': 'XMLHttpRequest' } })
            .then(res => res.text())
            .then(html => mainContent.innerHTML = html)
            .catch(err => console.error('Error loading content:', err));
    }

    // Highlight sidebar active item
    function setActiveOption(className) {
        document.querySelectorAll('.nav-option').forEach(opt => opt.classList.remove('active'));
        const target = document.querySelector('.' + className);
        if (target) target.classList.add('active');
    }
});

document.querySelector('.option2').addEventListener('click', function(e){
    e.preventDefault();

    fetch("{% url 'update_donor_detail' %}", {headers: {'X-Requested-With': 'XMLHttpRequest'}})
        .then(res => res.text())
        .then(html => {
            document.getElementById('main-content').innerHTML = html;
        });
});
</script>

 <style>
    .welcome-admin img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #c82333; /* optional border */
    margin-right: 10px;
}

header.header {
    background-color: #f8f9fa; /* light gray background */
    padding: 10px 20px;
    display: flex;
    justify-content: space-between; /* logo left, profile right */
    align-items: center;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.logosec .logo {
    font-size: 24px;
    font-weight: bold;
    color: #c82333; /* optional color */
}

.welcome-admin {
    display: flex;
    align-items: center;
}

.welcome-admin img {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    object-fit: cover;
    border: 2px solid #c82333; /* optional border */
    margin-right: 10px;
}

.welcome-admin span {
    font-weight: 500;
    color: #333;
}
</style>

{% endblock %}
