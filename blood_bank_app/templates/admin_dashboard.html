{% extends 'master.html' %}
{% load static %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<header class="header">
    <div class="logosec">
        <div class="logo">Admin Dashboard</div>
        <h2 class="welcome-admin">Welcome, {{ user.username }}</h2>
    </div>

   
</header>

<div class="main-container">
    <div class="navcontainer">
        <nav class="nav">
            <div class="nav-upper-options">

                <div class="nav-option option1 " data-page="{% url 'admin_dashboard_content' %}">
                    <i class="fas fa-tachometer-alt"></i>
                    <h3>Dashboard</h3>
                </div>

                <div class="nav-option option2" data-page="{% url 'manage_users' %}">
                    <i class="fas fa-user-cog"></i>
                    <h3>Manage Users</h3>
                </div>

                <div class="nav-option option3" data-page="{% url 'manage_bloodstock' %}">
                    <i class="fa fa-users"></i>
                    <h3>Manage Blood Stock</h3>
                </div>
                <div class="nav-option option4" data-page="{% url 'manage_requests' %}">
                    <i class="fa fa-users"></i>
                    <h3>Manage Requests</h3>
                </div>
                <div class="nav-option option5" data-page="{% url 'view_reports' %}">
                    <i class="fa fa-users"></i>
                    <h3>View Reports</h3>
                </div>
                <div>
                <a href="{% url 'logout' %}" class="nav-option option4">
                    <i class="fa fa-sign-out-alt"></i>
                    <h3>Logout</h3>
                </a>
                </div>
            </div>
        </nav>
    </div>

    <div class="main" id="main-content">
        <!-- Dynamic content loads here -->
    </div>
</div>

 <!-- ================== JS Script ==================  -->
 <script> 
document.addEventListener('DOMContentLoaded', function() {
    const mainContent = document.getElementById('main-content');
    const params = new URLSearchParams(window.location.search);
    const section = params.get('section');
    const message = params.get('msg');

    // ✅ Show success message if exists
    if (message) {
        const alertBox = document.createElement('div');
        alertBox.classList.add('alert-success');
        alertBox.textContent = decodeURIComponent(message);
        document.body.prepend(alertBox);
        setTimeout(() => alertBox.remove(), 3000);
    }

    // ✅ Decide which section to show first
    let defaultPageUrl = "{% url 'admin_dashboard_content' %}";
    if (section === 'manage_bloodstock') {
        defaultPageUrl = "{% url 'manage_bloodstock' %}";
        setActiveOption('option3');
    } else if (section === 'manage_users') {
        defaultPageUrl = "{% url 'manage_users' %}";
        setActiveOption('option2');
    } else if (section === 'manage_requests') {
        defaultPageUrl = "{% url 'manage_requests' %}";
        setActiveOption('option4');
    } else if (section === 'view_reports') {
        defaultPageUrl = "{% url 'view_reports' %}";
        setActiveOption('option5');
    } else {
        setActiveOption('option1');
    }

    // ✅ Load the correct section
    fetch(defaultPageUrl)
        .then(response => response.text())
        .then(html => mainContent.innerHTML = html)
        .catch(err => console.error('Error loading content:', err));

    // ✅ Sidebar click handling
    document.querySelectorAll('.nav-option').forEach(item => {
        item.addEventListener('click', function(e) {
            // Don't block logout link
            if (this.classList.contains('option4')) return;

            e.preventDefault();
            const pageUrl = this.getAttribute('data-page');
            if (!pageUrl) return;

            document.querySelectorAll('.nav-option').forEach(opt => opt.classList.remove('active'));
            this.classList.add('active');

            fetch(pageUrl)
                .then(response => response.text())
                .then(html => mainContent.innerHTML = html)
                .catch(err => console.error('Error loading page:', err));
        });
    });

    // Helper for active state
    function setActiveOption(className) {
        document.querySelectorAll('.nav-option').forEach(opt => opt.classList.remove('active'));
        const target = document.querySelector('.' + className);
        if (target) target.classList.add('active');
    }
});
</script> 


{% endblock %}
